<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Era Wallet</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #121212;
      --bg-medium: #1e1e1e;
      --bg-light: #2c2c2c;
      --primary-accent: #00e676; /* Green */
      --secondary-accent: #ffeb3b; /* Yellow */
      --text-light: #e0e0e0;
      --text-dark: #333;
      --border-color: #3a3a3a;
      --shadow-color: rgba(0, 0, 0, 0.4);
      --input-bg: #333;
      --button-hover: #00c853;
      --link-color: #03a9f4; /* Light Blue */
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-light);
      text-align: center;
      padding: 20px;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start; /* Align to the top to prevent jumping on content changes */
      min-height: 100vh;
      box-sizing: border-box;
    }

    .container {
      max-width: 480px;
      width: 100%;
      background-color: var(--bg-medium);
      padding: 35px;
      border-radius: 20px;
      box-shadow: 0 10px 30px var(--shadow-color);
      margin-top: 40px;
      transition: all 0.3s ease-in-out;
      border: 1px solid var(--border-color);
    }

    h1 {
      font-size: 2.2em;
      color: var(--primary-accent);
      margin-bottom: 30px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    h1 svg {
      color: var(--secondary-accent);
    }

    h3 {
      font-size: 1.4em;
      color: var(--text-light);
      margin-top: 35px;
      margin-bottom: 20px;
      font-weight: 600;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
    }

    input, select {
      width: calc(100% - 24px); /* Account for padding */
      padding: 12px;
      font-size: 1em;
      border-radius: 10px;
      border: 1px solid var(--border-color);
      margin-bottom: 15px;
      background-color: var(--input-bg);
      color: var(--text-light);
      box-sizing: border-box; /* Include padding in width */
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary-accent);
      box-shadow: 0 0 0 2px rgba(0, 230, 118, 0.3);
    }

    button {
      padding: 12px 25px;
      font-size: 1.05em;
      border-radius: 10px;
      border: none;
      margin: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      background-color: var(--primary-accent);
      color: var(--text-dark);
      box-shadow: 0 4px 15px rgba(0, 230, 118, 0.3);
    }

    button:hover {
      background-color: var(--button-hover);
      transform: translateY(-2px);
    }

    button.secondary {
      background-color: var(--bg-light);
      color: var(--text-light);
      border: 1px solid var(--border-color);
      box-shadow: none;
    }

    button.secondary:hover {
      background-color: var(--border-color);
      transform: translateY(-2px);
    }

    .balance {
      font-size: 1.8em;
      margin: 25px 0;
      color: var(--secondary-accent);
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .deposit-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-bottom: 25px;
    }

    .deposit-buttons button {
      flex: 1 1 calc(33% - 24px); /* 3 buttons per row */
      max-width: 120px;
      padding: 10px 15px;
      font-size: 0.95em;
      background-color: var(--bg-light);
      color: var(--text-light);
      border: 1px solid var(--border-color);
      box-shadow: none;
    }

    .deposit-buttons button:hover {
      background-color: var(--primary-accent);
      color: var(--text-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 230, 118, 0.3);
    }

    #qr-container {
      background-color: var(--bg-light);
      padding: 20px;
      border-radius: 15px;
      margin-top: 20px;
      border: 1px solid var(--border-color);
      box-shadow: inset 0 0 10px rgba(0, 230, 118, 0.1);
    }

    #qr-container p {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 1.1em;
      color: var(--primary-accent);
    }

    #qr-container img {
      width: 180px;
      height: 180px;
      margin-bottom: 20px;
      border-radius: 12px;
      box-shadow: 0 5px 20px var(--shadow-color);
      border: 3px solid var(--primary-accent);
      background-color: white; /* Ensure QR code background is visible */
    }

    a {
      color: var(--link-color);
      text-decoration: none;
      font-weight: 600;
      margin-top: 30px;
      display: inline-block;
      transition: color 0.3s ease;
    }

    a:hover {
      color: var(--primary-accent);
    }

    /* Utility classes for icons */
    .icon {
        vertical-align: middle;
        margin-right: 5px;
    }
  </style>
</head>
<body>
  <div class="container" id="auth-screen">
    <h1><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></path><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg> Era Wallet Login</h1>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="login()">Login</button>
    <button onclick="signup()" class="secondary">Signup</button>
  </div>

  <div class="container" id="wallet-screen" style="display:none;">
    <h1><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M20 7h-9"></path><path d="M14 17H5"></path><path d="M6 17a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path><path d="M18 7a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path><path d="M20 17a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path></svg> My Wallet</h1>
    <p>Welcome, <span id="user-display"></span>!</p>
    <div class="balance">Current Balance: ₱<span id="coins">0</span></div>

    <h3><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg> Deposit Funds</h3>
    <p>Select Deposit Amount:</p>
    <div class="deposit-buttons">
      <button onclick="showQRCode(50)">₱50</button>
      <button onclick="showQRCode(100)">₱100</button>
      <button onclick="showQRCode(200)">₱200</button>
      <button onclick="showQRCode(500)">₱500</button>
      <button onclick="showQRCode(1000)">₱1000</button>
    </div>

    <div id="qr-container" style="display:none;">
      <p><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg> Scan QR to deposit ₱<span id="qr-amount">0</span></p>
      <img id="qr-image" src="" alt="GCash QR Code" /> <!-- src is empty, filled by JS -->
      <input type="text" id="reference-code" placeholder="Enter GCash Reference Code" />
      <button onclick="submitDepositRequest()">Submit to Admin</button>
    </div>

    <h3><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg> Request Withdrawal</h3>
    <input type="number" id="withdraw-amount" placeholder="Amount (₱)" min="1" />
    <select id="withdraw-method">
      <option value="">Select Method</option>
      <option value="GCash">GCash</option>
      <option value="PayMaya">PayMaya</option>
      <option value="GoTyme">GoTyme</option>
      <option value="Bank">Bank</option>
    </select>
    <input type="text" id="withdraw-account" placeholder="Phone or Account Number" />
    <button onclick="submitWithdrawRequest()">Submit Withdrawal</button>

    <br><br>
    <a href="index.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg> Back to Era Hub</a>
  </div>

  <script>
    let currentUser = localStorage.getItem("currentUser");
    let coins = 0;

    // Initial check for user login
    if (currentUser) {
      if (currentUser === "admin") {
        window.location.href = "admin.html";
      } else {
        // This block executes if a regular user is logged in
        const savedBalance = localStorage.getItem(`balance_${currentUser}`);
        coins = savedBalance ? parseInt(savedBalance) : 0;
        document.getElementById('user-display').textContent = currentUser;
        document.getElementById('coins').textContent = coins.toLocaleString(); // Format balance
        document.getElementById('auth-screen').style.display = "none";
        document.getElementById('wallet-screen').style.display = "block";
      }
    } else {
        // If no currentUser, display the auth screen
        document.getElementById('auth-screen').style.display = "block";
        document.getElementById('wallet-screen').style.display = "none";
    }


    function signup() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      if (!username || !password) {
        alert("Please enter both username and password.");
        return;
      }

      if (username.toLowerCase() === "admin") {
        alert("Reserved username. Please choose another.");
        return;
      }

      if (localStorage.getItem(`user_${username}`)) {
        alert("Username already exists. Please choose another.");
        return;
      }

      localStorage.setItem(`user_${username}`, password);
      localStorage.setItem(`balance_${username}`, "1000"); // Set initial balance on signup
      alert("Signup successful! You can now log in.");
      // Optional: Clear fields or automatically log in
      document.getElementById('username').value = "";
      document.getElementById('password').value = "";
    }

    function login() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      if (username === "admin" && password === "Umaysa2022@") {
        localStorage.setItem("currentUser", "admin");
        window.location.href = "admin.html";
        return;
      }

      const storedPassword = localStorage.getItem(`user_${username}`);
      if (!storedPassword) {
        alert("Username not found. Please sign up first.");
        return;
      }

      if (storedPassword !== password) {
        alert("Incorrect password.");
        return;
      }

      currentUser = username;
      localStorage.setItem("currentUser", username);

      const savedBalance = localStorage.getItem(`balance_${username}`);
      coins = savedBalance ? parseInt(savedBalance) : 0;

      document.getElementById('user-display').textContent = username;
      document.getElementById('coins').textContent = coins.toLocaleString(); // Format balance
      document.getElementById('auth-screen').style.display = "none";
      document.getElementById('wallet-screen').style.display = "block";
    }

    function showQRCode(amount) {
      document.getElementById('qr-amount').textContent = amount.toLocaleString();
      // CHANGED THIS LINE: Removed 'images/' prefix
      document.getElementById('qr-image').src = `${amount}gcash.jpg`; 
      document.getElementById('qr-container').style.display = "block";
    }

    function submitDepositRequest() {
      const amount = parseInt(document.getElementById("qr-amount").textContent.replace(/,/g, '')); // Remove commas for parsing
      const refCode = document.getElementById("reference-code").value.trim();

      if (!amount || !refCode) {
        alert("Please enter the reference code after scanning the QR.");
        return;
      }

      const request = {
        username: currentUser,
        amount,
        refCode,
        timestamp: new Date().toISOString(),
        status: "Pending"
      };

      let requests = JSON.parse(localStorage.getItem("depositRequests") || "[]");
      requests.push(request);
      localStorage.setItem("depositRequests", JSON.stringify(requests));

      alert("Deposit request submitted to admin. Please wait for approval.");
      document.getElementById("qr-container").style.display = "none";
      document.getElementById("reference-code").value = "";
    }

    function submitWithdrawRequest() {
      const amount = parseInt(document.getElementById("withdraw-amount").value);
      const method = document.getElementById("withdraw-method").value;
      const account = document.getElementById("withdraw-account").value.trim();

      if (!amount || amount <= 0 || !method || !account) {
        alert("Please fill in all withdrawal fields.");
        return;
      }

      if (amount > coins) {
        alert("Insufficient balance.");
        return;
      }

      coins -= amount;
      localStorage.setItem(`balance_${currentUser}`, coins.toString());
      document.getElementById("coins").textContent = coins.toLocaleString();

      const request = {
        username: currentUser,
        amount,
        method,
        account,
        timestamp: new Date().toISOString(),
        status: "Pending"
      };

      let requests = JSON.parse(localStorage.getItem("withdrawRequests") || "[]");
      requests.push(request);
      localStorage.setItem("withdrawRequests", JSON.stringify(requests));

      alert("Withdrawal request submitted. Balance deducted. Awaiting admin approval.");
      document.getElementById("withdraw-amount").value = "";
      document.getElementById("withdraw-method").value = "";
      document.getElementById("withdraw-account").value = "";
    }
  </script>
</body>
</html>
