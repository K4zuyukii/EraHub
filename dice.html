<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dice Roll: Odd or Even</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Montserrat:wght@300;400;700&display=swap');

    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #1a0033 0%, #000000 100%);
      color: #e0e0e0;
      text-align: center;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    .container {
      max-width: 500px;
      margin: auto;
      background: rgba(25, 25, 50, 0.7); /* Slightly transparent dark background */
      border: 2px solid #6a059f; /* Purple border */
      border-radius: 20px;
      box-shadow: 0 0 40px rgba(106, 5, 159, 0.6), 0 0 80px rgba(0, 255, 255, 0.2); /* Dual glow */
      padding: 40px;
      position: relative;
      z-index: 1;
      animation: fadeIn 1s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      font-family: 'Orbitron', sans-serif;
      color: #00ffff; /* Cyan neon */
      text-shadow: 0 0 15px #00ffff, 0 0 25px rgba(0, 255, 255, 0.5);
      margin-bottom: 30px;
      font-size: 2.8em;
      letter-spacing: 2px;
    }
    .scoreboard {
      margin-bottom: 30px;
      background-color: rgba(0, 0, 0, 0.4);
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #333;
      box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.1);
    }
    .scoreboard p {
      font-size: 1.4em;
      color: #00ff88; /* Green for balance */
      margin: 5px 0;
      font-family: 'Orbitron', sans-serif;
    }
    .scoreboard label {
      font-size: 1em;
      color: #e0e0e0;
      margin-top: 15px;
      display: block;
    }
    input[type="number"], select {
      padding: 12px;
      font-size: 1.1em;
      border-radius: 8px;
      border: 2px solid #6a059f; /* Purple border */
      margin: 10px;
      background-color: #2a0342; /* Darker purple input background */
      color: #e0e0e0;
      width: calc(100% - 40px);
      box-shadow: inset 0 0 8px rgba(0, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    input[type="number"]:focus, select:focus {
      border-color: #00ffff;
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.5), inset 0 0 10px rgba(0, 255, 255, 0.3);
      outline: none;
    }
    option {
        background-color: #2a0342;
        color: #e0e0e0;
    }

    .button-group {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 25px;
    }

    button {
      padding: 14px 25px;
      font-size: 1.2em;
      border-radius: 10px;
      border: none;
      font-weight: bold;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      position: relative;
      overflow: hidden;
    }
    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: all 0.7s;
    }
    button:hover::before {
      left: 100%;
    }
    button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        box-shadow: none;
    }
    button:disabled:hover::before {
        left: -100%; /* Reset hover effect for disabled buttons */
    }


    .roll-button {
      background-color: #00ff88; /* Bright green */
      color: #1a0033;
      border: 2px solid #00e676;
    }
    .roll-button:hover {
      background-color: #00e676;
      box-shadow: 0 0 20px #00ff88, 0 0 30px #00ff88;
      transform: translateY(-2px);
    }
    .reset-button {
      background-color: #ff4d4d; /* Reddish */
      color: #1a0033;
      border: 2px solid #cc3333;
    }
    .reset-button:hover {
      background-color: #cc3333;
      box-shadow: 0 0 20px #ff4d4d, 0 0 30px #ff4d4d;
      transform: translateY(-2px);
    }

    .dice-display {
      font-family: 'Orbitron', sans-serif;
      font-size: 120px; /* Larger dice */
      margin: 30px auto;
      width: 150px;
      height: 150px;
      line-height: 150px;
      border-radius: 25px;
      background-color: #1a0033; /* Dark purple */
      box-shadow: 0 0 30px #00ffff, inset 0 0 20px rgba(0, 255, 255, 0.4); /* Cyan glow */
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      animation: pulseDice 2s infinite alternate;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    @keyframes pulseDice {
      from { box-shadow: 0 0 20px #00ffff, inset 0 0 10px rgba(0, 255, 255, 0.3); }
      to { box-shadow: 0 0 40px #00ffff, inset 0 0 20px rgba(0, 255, 255, 0.6); }
    }
    .dice-animate {
      animation: spinAndGlow 0.8s ease-out forwards;
    }
    @keyframes spinAndGlow {
      0% { transform: rotateY(0deg) scale(1); opacity: 1; box-shadow: 0 0 30px #00ffff, inset 0 0 20px rgba(0, 255, 255, 0.4); }
      50% { transform: rotateY(360deg) scale(1.1); opacity: 0.8; box-shadow: 0 0 60px #ff00ff, inset 0 0 30px rgba(255, 0, 255, 0.6); } /* Magenta flash */
      100% { transform: rotateY(720deg) scale(1); opacity: 1; box-shadow: 0 0 30px #00ffff, inset 0 0 20px rgba(0, 255, 255, 0.4); }
    }

    .result-message {
      font-size: 1.6em;
      margin-top: 30px;
      font-weight: bold;
      text-shadow: 0 0 10px rgba(255,255,255,0.7);
      min-height: 1.6em; /* Prevent layout shift */
    }
    .result-message.win {
      color: #00ff88;
      text-shadow: 0 0 15px #00ff88, 0 0 25px rgba(0, 255, 136, 0.5);
    }
    .result-message.lose {
      color: #ff4d4d;
      text-shadow: 0 0 15px #ff4d4d, 0 0 25px rgba(255, 77, 77, 0.5);
    }
    .result-message.info {
      color: #ffd700; /* Gold for info messages */
      text-shadow: 0 0 15px #ffd700, 0 0 25px rgba(255, 215, 0, 0.5);
    }

    .back-button {
      display: inline-block;
      margin-top: 40px;
      color: #00ffff;
      text-decoration: none;
      font-weight: bold;
      font-size: 1.1em;
      padding: 8px 15px;
      border: 1px solid #00ffff;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    .back-button:hover {
      background-color: #00ffff;
      color: #1a0033;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.6);
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><span style="color:#ff00ff;">CYBER</span>DICE</h1>

    <div class="scoreboard">
      <p>üí∞ BALANCE: ‚Ç±<span id="coins">0</span></p>
      <label for="bet-amount">ENTER BET AMOUNT (‚Ç±1‚Äì‚Ç±500):</label>
      <input type="number" id="bet-amount" min="1" max="500" value="10" />
      <label for="choice">CHOOSE:</label>
      <select id="choice">
        <option value="odd">ODD</option>
        <option value="even">EVEN</option>
      </select>
    </div>

    <div id="dice" class="dice-display">üé≤</div>

    <div class="button-group">
      <button class="roll-button" id="rollButton" onclick="rollDice()">ROLL</button>
      <button class="reset-button" id="resetButton" onclick="resetDice()">RESET</button>
    </div>

    <p id="result" class="result-message"></p>
    <a href="index.html" class="back-button">‚¨Ö BACK TO MENU</a>

    <script>
      const currentUser = localStorage.getItem("currentUser");
      let coins = parseInt(localStorage.getItem(`balance_${currentUser}`)) || 0; // Initialize with 0 or stored value
      let isRolling = false; // Flag to prevent spamming rolls

      const rollButton = document.getElementById('rollButton');
      const resetButton = document.getElementById('resetButton');
      const diceEl = document.getElementById('dice');
      const betAmountInput = document.getElementById('bet-amount');
      const choiceSelect = document.getElementById('choice');
      const resultEl = document.getElementById('result');

      const animationDuration = 800; // Matches CSS animation duration

      function updateBalanceDisplay() {
          document.getElementById('coins').textContent = coins;
          localStorage.setItem(`balance_${currentUser}`, coins);
      }

      function displayMessage(message, type = 'info') {
          resultEl.textContent = message;
          resultEl.className = `result-message ${type}`;
      }

      function disableButtons(disabled) {
          rollButton.disabled = disabled;
          resetButton.disabled = disabled;
          betAmountInput.disabled = disabled;
          choiceSelect.disabled = disabled;
      }

      function rollDice() {
        if (isRolling) {
            displayMessage("Please wait for the current roll to complete!", "info");
            return;
        }

        const bet = parseInt(betAmountInput.value);
        const choice = choiceSelect.value;
        
        // Input validation
        if (isNaN(bet) || bet < 1 || bet > 500) {
          displayMessage("‚ùó Enter a valid bet (‚Ç±1‚Äì‚Ç±500).", "lose");
          return;
        }

        if (coins < bet) {
          displayMessage("üí∏ Insufficient balance to roll.", "lose");
          return;
        }

        // Start roll sequence
        isRolling = true;
        disableButtons(true); // Disable buttons during roll
        coins -= bet; // Deduct bet immediately
        updateBalanceDisplay();
        displayMessage("Rolling...", "info");

        const diceFaces = ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'];
        const roll = Math.floor(Math.random() * 6);
        const diceValue = roll + 1;
        
        diceEl.classList.add("dice-animate");

        setTimeout(() => {
          diceEl.textContent = diceFaces[roll];
          diceEl.classList.remove("dice-animate");

          const isEven = diceValue % 2 === 0;
          const playerWins = (choice === "even" && isEven) || (choice === "odd" && !isEven);

          let resultText = `üé≤ ROLLED ${diceValue} ‚Äî `;
          if (playerWins) {
            coins += bet * 2; // Return bet + winnings
            resultText += "üéâ YOU WIN!";
            displayMessage(resultText, 'win');
          } else {
            resultText += "üò¢ YOU LOSE!";
            displayMessage(resultText, 'lose');
          }

          updateBalanceDisplay();
          isRolling = false;
          disableButtons(false); // Re-enable buttons after roll
        }, animationDuration); // Use defined animation duration
      }

      function resetDice() {
        if (isRolling) {
            displayMessage("Cannot reset while rolling. Please wait.", "info");
            return;
        }
        diceEl.textContent = "üé≤";
        displayMessage("", "info"); // Clear result message
        betAmountInput.value = "10"; // Reset bet to a default
        choiceSelect.value = "odd"; // Reset choice
        disableButtons(false); // Ensure buttons are enabled
      }

      // Initial setup on page load
      window.onload = function() {
          if (!currentUser) {
              displayMessage("No user logged in. Redirecting to menu...", "lose");
              // Use a short delay before redirecting to allow message to be seen
              setTimeout(() => {
                  window.location.href = "index.html";
              }, 2000);
              return;
          }
          // If balance is NaN or null for the current user, initialize it
          if (isNaN(coins) || coins === null) {
              coins = 1000; // Provide a starting balance if it's missing or invalid
              updateBalanceDisplay();
              displayMessage("Welcome! Your balance has been set to ‚Ç±1000.", "info");
          } else {
              updateBalanceDisplay(); // Just update display if balance is good
          }
          disableButtons(false); // Ensure buttons are enabled on load
      };
    </script>
  </div>
</body>
</html>